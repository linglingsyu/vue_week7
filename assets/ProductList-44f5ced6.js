import{d as C,a as m,A as _,M,m as x,_ as U,o as d,c,b as t,w as n,v as p,e as L,F as v,r as k,f as P,g as h,t as b,h as D,i as f,j as g,k as A}from"./index-020ac884.js";import{p as w}from"./ProductStore-872f49e5.js";const B=C("productStore",{state:()=>({productList:[],Loading:!1,productById:[]}),getters:{isLoading:({Loading:s})=>s,products:({productList:s})=>s,product:({productById:s})=>s},actions:{async getProductList(){try{this.Loading=!0;const s=`api/${m}/products/all`,o=await _.get(s);this.productList=o.data.products,this.Loading=!1}catch(s){this.Loading=!1,console.dir(s),alert("error!")}},async getProductById(s){try{this.Loading=!0;const o=`/api/${m}/product/${s}`,l=await _.get(o);console.log(l),this.productById=l.data.product}catch(o){console.dir(o),alert("error!")}finally{this.Loading=!1}},async updateProduct(s,o){var l;try{this.Loading=!0;let a=`api/${m}/admin/product`,e="post";s==="edit"&&(a+="/"+o.id,e="put",delete o.id);const u=await _[e](a,{data:o});return await this.getProductList(),this.Loading=!1,u}catch(a){if(console.dir(a),this.Loading=!1,(l=a==null?void 0:a.response)!=null&&l.data){let e="";for(const u of a.response.data.message)e+=u+`
`;alert(e)}}},async delProduct(s){try{this.Loading=!0;const o=`/api/${m}/admin/product/${s}`,l=await _.delete(o);return delete this.productList[s],l}catch(o){console.dir(o),alert("error!")}finally{this.Loading=!1}},async upload(s){try{this.Loading=!0;const o=`/api/${m}/admin/upload`;return await _.post(o,s,{headers:{"Content-Type":"multipart/form-data"}})}catch(o){console.dir(o),alert("upload fail!")}finally{this.Loading=!1}}}}),I={name:"productModal",data(){return{modal:null,product:{title:"",category:"",unit:"",price:"",origin_price:"",description:"",content:"",imageUrl:"",imagesUrl:[],is_enabled:!0},image:"",imagesUrl:[]}},props:["productData"],mounted(){const s=this.$refs.modal;this.modal=new M(s)},methods:{...x(B,["upload"]),show(){this.modal.show()},async fileChange(s){var a;if(this.image=s.target.files[0],!this.image)return!1;const o=new FormData;o.append("file-to-upload",this.image);const l=await this.upload(o);(a=l.data)!=null&&a.success?this.product.imageUrl=l.data.imageUrl:alert(l.data.message)},async uploadImage(){if(!this.image)return!1;const s=new FormData;s.append("file-to-upload",this.file);const o=await this.upload(s);o.data.success?this.product.imageUrl=o.data.imageUrl:alert(o.data.message)}},watch:{productData(){this.product=this.productData}}},S={class:"modal",tabindex:"-1",ref:"modal"},T={class:"modal-dialog modal-dialog-centered modal-xl"},j={class:"modal-content"},F=t("div",{class:"modal-header"},[t("h5",{class:"modal-title"},"新增產品"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),N={class:"modal-body"},E={class:"row g-3"},q={class:"col-12"},z=t("label",{for:"title",class:"form-label"},"產品名稱",-1),G={class:"col-md-6"},H=t("label",{for:"category",class:"form-label"},"產品分類",-1),J={class:"col-md-6"},K=t("label",{for:"unit",class:"form-label"},"單位",-1),O={class:"col-md-6"},Q=t("label",{for:"price",class:"form-label"},"產品價錢",-1),R={class:"col-md-6"},W=t("label",{for:"origin_price",class:"form-label"},"產品原價",-1),X={class:"col-12"},Y=t("label",{for:"description",class:"form-label"},"產品描述",-1),Z={class:"col-md-12"},tt=t("label",{for:"content",class:"form-label"},"產品內容",-1),ot={class:"col-md-12"},st=t("label",{for:"image",class:"form-label"},[h("產品主圖 "),t("span",{class:"text-muted"},"*僅能上傳一張(限jpg/png檔)")],-1),et={key:0},it=["src"],lt={class:"col-md-12"},at=t("label",{for:"images",class:"form-label"},[h("產品圖片 "),t("span",{class:"text-muted"},"*可上傳多張(限jpg/png檔)")],-1),rt=t("input",{class:"form-control",type:"file",id:"images"},null,-1),nt={key:0},dt=["src"],ct={class:"col-12"},ut={class:"form-check"},pt=t("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),mt={class:"modal-footer"},_t=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 關閉 ",-1),ht=t("button",{type:"button",class:"btn btn-primary"},"儲存",-1);function ft(s,o,l,a,e,u){return d(),c("div",S,[t("div",T,[t("div",j,[F,t("div",N,[t("form",E,[t("div",q,[z,n(t("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":o[0]||(o[0]=i=>e.product.title=i)},null,512),[[p,e.product.title,void 0,{trim:!0}]])]),t("div",G,[H,n(t("input",{type:"text",class:"form-control",id:"category","onUpdate:modelValue":o[1]||(o[1]=i=>e.product.category=i)},null,512),[[p,e.product.category,void 0,{trim:!0}]])]),t("div",J,[K,n(t("input",{type:"text",class:"form-control",id:"unit",placeholder:"組/個","onUpdate:modelValue":o[2]||(o[2]=i=>e.product.unit=i)},null,512),[[p,e.product.unit,void 0,{trim:!0}]])]),t("div",O,[Q,n(t("input",{type:"number",min:"0",class:"form-control",id:"price","onUpdate:modelValue":o[3]||(o[3]=i=>e.product.price=i)},null,512),[[p,e.product.price,void 0,{number:!0}]])]),t("div",R,[W,n(t("input",{type:"number",class:"form-control",id:"origin_price","onUpdate:modelValue":o[4]||(o[4]=i=>e.product.origin_price=i)},null,512),[[p,e.product.origin_price,void 0,{number:!0}]])]),t("div",X,[Y,n(t("input",{type:"text",class:"form-control",id:"description","onUpdate:modelValue":o[5]||(o[5]=i=>e.product.description=i)},null,512),[[p,e.product.description,void 0,{trim:!0}]])]),t("div",Z,[tt,n(t("textarea",{class:"form-control",id:"content","onUpdate:modelValue":o[6]||(o[6]=i=>e.product.content=i)},null,512),[[p,e.product.content,void 0,{trim:!0}]])]),t("div",ot,[st,t("input",{class:"form-control",type:"file",id:"image",onChange:o[7]||(o[7]=(...i)=>u.fileChange&&u.fileChange(...i))},null,32),e.product.imageUrl?(d(),c("div",et,[t("img",{src:e.product.imageUrl,width:"150",alt:""},null,8,it)])):L("",!0)]),t("div",lt,[at,rt,e.product.imagesUrl?(d(),c("div",nt,[(d(!0),c(v,null,k(e.product.imagesUrl,(i,y)=>(d(),c("img",{src:i,alt:"",key:`image${y}`},null,8,dt))),128))])):L("",!0)]),t("div",ct,[t("div",ut,[n(t("input",{class:"form-check-input",type:"checkbox",id:"is_enabled","onUpdate:modelValue":o[8]||(o[8]=i=>e.product.is_enabled=i)},null,512),[[P,e.product.is_enabled]]),pt])])])]),t("div",mt,[h(b(e.image)+" ",1),_t,ht])])])],512)}const gt=U(I,[["render",ft]]),bt={mounted(){this.getProductList()},components:{productModal:gt},methods:{...x(w,["getProductList"])},computed:{...D(w,["isLoading","products"])}},yt={class:"vl-parent"},vt={class:"container"},Lt={class:"d-flex align-items-center justify-content-between mb-5"},wt=t("h1",null,"產品列表",-1),xt=t("thead",null,[t("tr",null,[t("th",null,"圖片"),t("th",null,"商品名稱"),t("th",null,"價格"),t("th")])],-1),Ut={width:"200"},kt=["src"],Vt={class:"text-start"},$t={class:"text-decoration-line-through"},Ct=t("br",null,null,-1),Mt={width:"200"},Pt=t("a",{class:"btn btn-sm btn-outline-danger",href:"#"},"加入購物車",-1),Dt=t("div",{class:"position-relative"},null,-1);function At(s,o,l,a,e,u){const i=f("isLoading"),y=f("vToast"),V=f("router-link"),$=f("productModal");return d(),c(v,null,[t("div",yt,[g(i,{active:s.isLoading},null,8,["active"]),g(y,{status:"true",errorMessage:"錯誤訊息"}),t("div",vt,[t("div",Lt,[wt,t("button",{type:"button",class:"btn btn-primary",onClick:o[0]||(o[0]=(...r)=>this.$refs.Addmodal.show&&this.$refs.Addmodal.show(...r))}," 新增產品 ")]),t("table",null,[xt,t("tbody",null,[(d(!0),c(v,null,k(s.products,r=>(d(),c("tr",{key:r.id},[t("td",Ut,[t("img",{class:"w-50",src:r.image,alt:"productImage"},null,8,kt)]),t("td",Vt,b(r.title),1),t("td",null,[t("span",$t,b(r.origin_price),1),Ct,h("現在只要"+b(r.price)+"元 ",1)]),t("td",Mt,[g(V,{class:"btn btn-sm btn-outline-primary mx-1",to:"/product/"+r.id},{default:A(()=>[h("查到更多")]),_:2},1032,["to"]),Pt])]))),128))])])])]),Dt,g($,{ref:"Addmodal"},null,512)],64)}const St=U(bt,[["render",At]]);export{St as default};
